import{r as o,j as e,M as le,S as ne,N as R,B as L,C as F,a as M,U as A,L as oe,b as P,H as q,c as G,T as ie,d as de,X as K,e as ce,f as xe,g as me,h as he,i as ue,u as Q,k as _,l as ge,m as be,n as H,o as fe,P as pe,p as je,q as ke,s as we,W as Ne,t as W,v as ve,w as ye,R as Se,x as E,y as Ce,z as Pe}from"./react-DQJ6Sioy.js";import{G as Be}from"./vendor-B861TBLW.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=r(s);fetch(s.href,l)}})();function z(t,a){const[r,n]=o.useState(()=>{try{const s=window.localStorage.getItem(t);if(s)return JSON.parse(s)}catch(s){console.error(`Error reading localStorage key “${t}”:`,s)}return a});return o.useEffect(()=>{try{window.localStorage.setItem(t,JSON.stringify(r))}catch(s){console.error(`Error setting localStorage key “${t}”:`,s)}},[t,r]),[r,n]}const X=o.createContext(void 0),Ee=({children:t})=>{const[a,r]=z("story-user",null),[n,s]=z("all_bookmarks",{}),l=c=>r(c),i=()=>{r(null)},g=a?n[a]||[]:[],b={user:a,login:l,logout:i,bookmarks:g,toggleBookmark:c=>{a&&s(x=>{const h=x[a]||[],j=h.includes(c)?h.filter(m=>m!==c):[...h,c];return{...x,[a]:j}})}};return e.jsx(X.Provider,{value:b,children:t})},S=()=>{const t=o.useContext(X);if(t===void 0)throw new Error("useUser must be used within a UserProvider");return t},Y=o.createContext(void 0),Le=({children:t})=>{const[a,r]=z("theme","dark");o.useEffect(()=>{const s=window.document.documentElement;s.classList.remove("light","dark"),s.classList.add(a)},[a]);const n=()=>{r(s=>s==="light"?"dark":"light")};return e.jsx(Y.Provider,{value:{theme:a,toggleTheme:n},children:t})},Te=()=>{const t=o.useContext(Y);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t},$e=()=>{const{theme:t,toggleTheme:a}=Te();return e.jsxs("button",{onClick:a,className:"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 p-2 rounded-full transition-colors",title:t==="light"?"التحويل للوضع المظلم":"التحويل للوضع المضيء",children:[e.jsx("span",{className:"sr-only",children:"Toggle theme"}),t==="light"?e.jsx(le,{className:"h-5 w-5"}):e.jsx(ne,{className:"h-5 w-5"})]})},Re=()=>{const{user:t,logout:a}=S(),r={backgroundColor:"rgb(71 85 105)",color:"white"},n={backgroundColor:"rgb(51 65 85)",color:"white"};return e.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm sticky top-0 z-50 shadow-md dark:shadow-lg dark:shadow-slate-950/20 border-b border-slate-200 dark:border-slate-800",children:e.jsx("nav",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(R,{to:"/",className:"flex-shrink-0 flex items-center gap-2 text-slate-900 dark:text-white font-bold text-xl",children:[e.jsx(L,{className:"h-7 w-7 text-indigo-500 dark:text-indigo-400"}),e.jsx("span",{children:"نسيج الحكايات"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsxs(R,{to:"/",className:"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white px-3 py-2 rounded-md text-sm font-medium flex items-center gap-2 transition-colors",style:({isActive:s})=>s?document.documentElement.classList.contains("dark")?n:r:{},children:[e.jsx(L,{className:"h-5 w-5"}),e.jsx("span",{children:"القصص"})]}),e.jsxs(R,{to:"/create",className:"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white px-3 py-2 rounded-md text-sm font-medium flex items-center gap-2 transition-colors",style:({isActive:s})=>s?document.documentElement.classList.contains("dark")?n:r:{},children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{children:"أنشئ قصة"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx($e,{}),t&&e.jsxs(e.Fragment,{children:[e.jsx(R,{to:"/reading-list",className:"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 p-2 rounded-full",title:"قائمة القراءة",children:e.jsx(M,{className:"h-5 w-5"})}),e.jsxs(R,{to:`/profile/${t}`,className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 p-2 rounded-md hover:bg-slate-200 dark:hover:bg-slate-700",title:"ملفك الشخصي",children:[e.jsx(A,{className:"h-5 w-5 text-slate-500 dark:text-slate-400"}),e.jsx("span",{className:"font-medium hidden sm:inline",children:t})]}),e.jsx("button",{onClick:a,className:"text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 p-2 rounded-full text-sm font-medium flex items-center gap-2 transition-colors",title:"تسجيل الخروج",children:e.jsx(oe,{className:"h-5 w-5"})})]})]})]})})})},D=({story:t})=>e.jsx(P,{to:`/story/${t.id}`,className:"block group",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg overflow-hidden shadow-md hover:shadow-lg dark:hover:shadow-indigo-500/30 border border-slate-200 dark:border-slate-700 transition-all duration-300 transform hover:-translate-y-1 h-full flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.coverImage,alt:t.title,className:"w-full h-64 object-cover"}),e.jsx("span",{className:"absolute top-2 right-2 bg-indigo-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-md",children:t.category})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-grow",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors duration-300 mb-2 truncate",children:t.title}),e.jsxs(P,{to:`/profile/${t.author}`,onClick:a=>a.stopPropagation(),className:"flex items-center gap-2 text-slate-500 dark:text-slate-400 text-xs mb-2 hover:text-slate-800 dark:hover:text-slate-300 transition-colors w-fit",children:[e.jsx(A,{className:"h-3 w-3"}),e.jsx("span",{children:t.author})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-sm line-clamp-3 flex-grow",children:t.content}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-slate-500 dark:text-slate-400 text-xs pt-3 border-t border-slate-200 dark:border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{children:t.likedBy.length})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-4 w-4 text-sky-500"}),e.jsx("span",{children:t.comments.length})]})]})]})]})}),Ae=[],V=["خيال","مغامرة","دراما","كوميديا","رعب","خيال علمي","رومانسي","أطفال"],Ie=({stories:t})=>{const[a,r]=o.useState(""),[n,s]=o.useState("الكل"),l=o.useMemo(()=>[...t].sort((d,b)=>{const c=d.likedBy.length*2+d.comments.length;return b.likedBy.length*2+b.comments.length-c}).slice(0,4),[t]),i=o.useMemo(()=>{let d=t;if(n!=="الكل"&&(d=d.filter(b=>b.category===n)),a.trim()!==""){const b=a.toLowerCase();d=d.filter(c=>c.title.toLowerCase().includes(b)||c.content.toLowerCase().includes(b))}return d},[t,a,n]),g=["الكل",...V];return e.jsxs("div",{className:"animate-fade-in space-y-16",children:[e.jsxs("div",{className:"text-center pt-8 pb-12 px-4",children:[e.jsxs("h1",{className:"text-5xl md:text-6xl font-black text-slate-900 dark:text-slate-100 mb-4",children:["أطلق العنان لـ",e.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-cyan-500 dark:from-indigo-400 dark:to-cyan-400",children:"خيالك"})]}),e.jsx("p",{className:"max-w-2xl mx-auto text-lg text-slate-600 dark:text-slate-400 mb-8",children:"منصة عربية مدعومة بالذكاء الاصطناعي لإنشاء ومشاركة قصص فريدة. اكتب عنوانًا، ودع السحر يبدأ."}),e.jsxs(P,{to:"/create",className:"inline-flex items-center justify-center gap-2 bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-500 transition-transform transform hover:scale-105 shadow-lg hover:shadow-indigo-500/50",children:[e.jsx(F,{className:"h-6 w-6"}),e.jsx("span",{children:"أنشئ قصتك الآن"})]})]}),l.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx(ie,{className:"h-8 w-8 text-indigo-500 dark:text-indigo-400"}),e.jsx("h2",{className:"text-3xl font-bold",children:"القصص الأكثر رواجًا"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:l.map(d=>e.jsx(D,{story:d},d.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx(L,{className:"h-8 w-8 text-indigo-500 dark:text-indigo-400"}),e.jsx("h2",{className:"text-3xl font-bold",children:"كل القصص"})]}),e.jsxs("div",{className:"mb-10 space-y-6 p-6 bg-white dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"relative max-w-lg mx-auto",children:[e.jsx("input",{type:"text",value:a,onChange:d=>r(d.target.value),placeholder:"ابحث عن قصة...",className:"w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-full py-3 pr-12 pl-12 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 text-slate-400 pointer-events-none",children:e.jsx(de,{className:"h-5 w-5"})}),a&&e.jsx("button",{onClick:()=>r(""),className:"absolute inset-y-0 left-0 flex items-center pl-4 text-slate-400 hover:text-slate-700 dark:hover:text-white","aria-label":"مسح البحث",children:e.jsx(K,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2",children:g.map(d=>e.jsx("button",{onClick:()=>s(d),className:`px-4 py-2 text-sm font-medium rounded-full transition-colors duration-200 ${n===d?"bg-indigo-600 text-white shadow-md":"bg-slate-200 dark:bg-slate-700/50 text-slate-700 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-700"}`,children:d},d))})]}),i.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8",children:i.map(d=>e.jsx(D,{story:d},d.id))}):e.jsxs("div",{className:"text-center py-16 px-6 bg-white dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsx(ce,{className:"mx-auto h-16 w-16 text-slate-400 dark:text-slate-500 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-slate-700 dark:text-slate-300",children:t.length===0?"لم يتم نشر أي قصص بعد":"لا توجد قصص تطابق بحثك"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:t.length===0?"كن أول من يبدع قصة جديدة!":"جرّب البحث بكلمات أخرى أو تغيير التصنيف."}),t.length===0&&e.jsxs(P,{to:"/create",className:"mt-6 inline-flex items-center justify-center gap-2 bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-500 transition-transform transform hover:scale-105",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{children:"أنشئ قصة الآن"})]})]})]})]})},Fe=({comments:t,onAddComment:a})=>{const[r,n]=o.useState(""),{user:s}=S(),l=i=>{i.preventDefault(),r.trim()&&(a(r.trim()),n(""))};return e.jsxs("div",{className:"mt-12",children:[e.jsxs("h3",{className:"text-2xl font-bold mb-6 flex items-center gap-3 text-slate-800 dark:text-white",children:[e.jsx(G,{className:"h-7 w-7 text-sky-500 dark:text-sky-400"}),"التعليقات (",t.length,")"]}),e.jsx("div",{className:"space-y-4 mb-6",children:t.length>0?t.map(i=>e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-200",children:i.author}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 whitespace-pre-wrap",children:i.text})]},i.id)):e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"لا توجد تعليقات بعد. كن أول من يعلق!"})}),s&&e.jsxs("form",{onSubmit:l,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:r,onChange:i=>n(i.target.value),placeholder:"أضف تعليقاً...",className:"flex-grow bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md py-2 px-4 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"}),e.jsxs("button",{type:"submit",className:"bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-500 transition-colors flex items-center gap-2 disabled:bg-slate-400 dark:disabled:bg-slate-500 disabled:cursor-not-allowed",disabled:!r.trim(),children:[e.jsx(xe,{className:"h-5 w-5"}),e.jsx("span",{children:"إرسال"})]})]})]})},Me=()=>{const[t,a]=o.useState(!1),[r,n]=o.useState(!1),s=o.useRef(null),l=o.useRef(null),i=o.useRef([]),g=o.useRef([]),d=typeof window<"u"&&"speechSynthesis"in window,b=o.useRef(()=>{}),c=o.useCallback(()=>{if(l.current){const f=l.current.getVoices();f.length&&(i.current=f)}},[]);o.useEffect(()=>{if(!d)return;l.current=window.speechSynthesis;const f=()=>c();c(),l.current.getVoices().length>0&&c(),l.current.addEventListener("voiceschanged",f);const u=setInterval(()=>{var w;(w=l.current)!=null&&w.paused&&l.current.resume()},5e3);return()=>{clearInterval(u),l.current&&(l.current.removeEventListener("voiceschanged",f),b.current())}},[d,c]);const x=o.useCallback(()=>{l.current&&(g.current=[],l.current.speaking&&l.current.cancel(),a(!1),n(!1),s.current=null)},[]);b.current=x;const h=o.useCallback(f=>{if(!l.current||!f)return;i.current.length===0&&c();const u=new SpeechSynthesisUtterance(f);s.current=u;const w=i.current.find(k=>k.lang==="ar-SA")||i.current.find(k=>k.lang.startsWith("ar"));w&&(u.voice=w),u.lang="ar-SA",u.rate=1,u.pitch=1,u.onstart=()=>{a(!0),n(!1)},u.onpause=()=>{n(!0)},u.onresume=()=>{n(!1)},u.onend=()=>{if(g.current.length>0){const k=g.current.shift();k&&setTimeout(()=>h(k),50)}else a(!1),n(!1),s.current=null},u.onerror=k=>{console.error("Speech Synthesis Error:",k.error),x()},l.current.speak(u)},[c,x]),j=o.useCallback(f=>{if(!d||!f.trim()||!l.current)return;x();const u=f.replace(/(\r\n|\n|\r)/gm," ").trim(),w=u.match(/[^.!?…]+[.!?…]?/g)||[u];g.current=w.map(B=>B.trim()).filter(Boolean);const k=g.current.shift();k&&setTimeout(()=>h(k),100)},[d,x,h]),m=o.useCallback(()=>{var f;(f=l.current)!=null&&f.speaking&&!l.current.paused&&l.current.pause()},[]),N=o.useCallback(()=>{var f;(f=l.current)!=null&&f.paused&&l.current.resume()},[]);return{isSpeaking:t,isPaused:r,play:j,pause:m,resume:N,stop:x,isSupported:d}},ze=({title:t,text:a})=>{const[r,n]=o.useState(!1),[s,l]=o.useState(!1),[i,g]=o.useState(!1);o.useEffect(()=>{typeof navigator<"u"&&(navigator.share?(g(!0),l(!0)):navigator.clipboard&&l(!0))},[]);const d=typeof window<"u"?window.location.href:"",b=async()=>{if(i)try{await navigator.share({title:t,text:a,url:d})}catch(x){console.error("Share API error:",x),console.error("Data shared:",{title:t,text:a,url:d})}else navigator.clipboard&&navigator.clipboard.writeText(d).then(()=>{n(!0),setTimeout(()=>n(!1),2e3)}).catch(x=>{console.error("Failed to copy link:",x),alert("فشل نسخ الرابط.")})},c=s?i?"مشاركة القصة":r?"تم النسخ!":"نسخ الرابط":"المشاركة غير مدعومة في هذا المتصفح";return e.jsx("button",{onClick:b,className:"p-2 rounded-full bg-slate-600 dark:bg-slate-700 hover:bg-slate-500 dark:hover:bg-slate-600 text-white flex items-center gap-2 transition-all duration-200 disabled:bg-slate-500 dark:disabled:bg-slate-800 disabled:text-slate-400 dark:disabled:text-slate-500 disabled:cursor-not-allowed",title:c,disabled:!s||r,children:r?e.jsx(me,{className:"h-5 w-5 text-green-400"}):i?e.jsx(he,{className:"h-5 w-5"}):e.jsx(ue,{className:"h-5 w-5"})})},De=({storyId:t})=>{const{bookmarks:a,toggleBookmark:r,user:n}=S();if(!n)return null;const s=a.includes(t);return e.jsx("button",{onClick:()=>r(t),className:"p-2 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center gap-2 transition-colors duration-200",title:s?"إزالة من قائمة القراءة":"إضافة إلى قائمة القراءة",children:e.jsx(M,{className:`h-5 w-5 transition-all ${s?"fill-yellow-400 text-yellow-400":"text-slate-300"}`})})},Ue=()=>{const[t,a]=o.useState(0);return o.useEffect(()=>{const r=()=>{const n=document.documentElement,s=n.clientHeight,l=n.scrollHeight,i=n.scrollTop,g=l-s;if(g<=0){a(0);return}const d=i/g*100;a(d)};return window.addEventListener("scroll",r,{passive:!0}),r(),()=>{window.removeEventListener("scroll",r)}},[]),t},Oe=()=>{const t=Ue();return e.jsx("div",{className:"fixed top-0 left-0 right-0 h-1 z-[100] pointer-events-none",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-cyan-400 transition-all duration-150 ease-linear",style:{width:`${t}%`}})})},He=({stories:t,onLike:a,onAddComment:r,onDelete:n})=>{const{id:s}=Q(),l=_(),{isSpeaking:i,isPaused:g,play:d,pause:b,resume:c,stop:x,isSupported:h}=Me(),{user:j}=S(),m=t.find(T=>T.id===s),[N,f]=o.useState("md"),[u,w]=o.useState("sans"),k={sm:"prose-base",md:"prose-lg",lg:"prose-xl"},B={sans:"font-sans",serif:"font-serif"};if(o.useEffect(()=>()=>x(),[s,x]),!m)return e.jsx(ge,{to:"/"});const U=j===m.author,C=j?m.likedBy.includes(j):!1,I=()=>{h&&(i?g?c():b():d(`${m.title}. ${m.content}`))},y=()=>{n(m.id)&&l("/")};return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{}),e.jsxs("div",{className:`max-w-4xl mx-auto bg-white dark:bg-slate-800 rounded-lg shadow-xl dark:shadow-2xl dark:shadow-slate-950/50 overflow-hidden animate-fade-in ${B[u]}`,children:[e.jsx("img",{src:m.coverImage,alt:m.title,className:"w-full h-64 md:h-96 object-cover"}),e.jsxs("div",{className:"p-6 md:p-10",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-2 mb-4",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 bg-indigo-100 dark:bg-indigo-500/20 text-indigo-700 dark:text-indigo-300 text-sm font-medium px-3 py-1 rounded-full",children:[e.jsx(be,{className:"h-4 w-4"}),m.category]}),U&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{to:`/edit/${m.id}`,className:"flex items-center gap-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-800 dark:text-white font-bold py-2 px-3 rounded-md transition-colors text-xs",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:"تعديل"})]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 bg-red-700/80 dark:bg-red-800/70 hover:bg-red-700 text-white font-bold py-2 px-3 rounded-md transition-colors text-xs",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:"حذف"})]})]})]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold mb-2 text-slate-900 dark:text-slate-100",children:m.title}),e.jsxs(P,{to:`/profile/${m.author}`,className:"flex items-center gap-2 text-slate-500 dark:text-slate-400 mb-6 text-sm hover:text-indigo-600 dark:hover:text-indigo-300 transition-colors w-fit",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs("span",{children:["بقلم: ",m.author]})]}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-6 mb-8 p-4 bg-slate-50 dark:bg-slate-850/50 rounded-lg border border-slate-200 dark:border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>a(m.id),className:`flex items-center gap-2 transition-colors duration-200 ${C?"text-red-500":"text-slate-500 dark:text-slate-400 hover:text-red-400"}`,"aria-pressed":C,title:C?"إلغاء الإعجاب":"أعجبني",children:[e.jsx(q,{className:`h-6 w-6 transition-transform ${C?"fill-current scale-110":"scale-100"}`}),e.jsx("span",{className:"font-bold text-lg",children:m.likedBy.length})]}),e.jsx("div",{className:"w-px h-6 bg-slate-200 dark:bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-2 text-white",children:[e.jsx("button",{onClick:I,title:h?i&&!g?"إيقاف مؤقت":g?"استئناف":"تشغيل السرد الصوتي":"السرد الصوتي غير مدعوم في هذا المتصفح",className:"p-2 rounded-full bg-indigo-600 hover:bg-indigo-500 disabled:bg-slate-500 dark:disabled:bg-slate-700 disabled:cursor-not-allowed",disabled:!h,children:i&&!g?e.jsx(pe,{className:"h-5 w-5"}):e.jsx(je,{className:"h-5 w-5"})}),i&&h&&e.jsx("button",{onClick:x,title:"إيقاف السرد",className:"p-2 rounded-full bg-slate-600 dark:bg-slate-700 hover:bg-slate-500 dark:hover:bg-slate-600",children:e.jsx(ke,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"w-px h-6 bg-slate-200 dark:bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-2 text-white",children:[e.jsx(ze,{title:m.title,text:`اقرأ قصة "${m.title}" على نسيج الحكايات!`}),e.jsx(De,{storyId:m.id})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-200 dark:bg-slate-700/50 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>w("sans"),className:`p-2 rounded-md transition-colors ${u==="sans"?"bg-indigo-500 dark:bg-indigo-600 text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-600"}`,title:"خط عصري",children:e.jsx(we,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>w("serif"),className:`p-2 rounded-md transition-colors ${u==="serif"?"bg-indigo-500 dark:bg-indigo-600 text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-600"}`,title:"خط كلاسيكي",children:e.jsx("i",{className:"font-serif not-italic text-xl",children:"أ"})}),e.jsx("div",{className:"w-px h-6 bg-slate-300 dark:bg-slate-600 mx-1"}),e.jsx("button",{onClick:()=>f("sm"),className:`px-2 py-1 text-xs rounded-md transition-colors ${N==="sm"?"bg-indigo-500 dark:bg-indigo-600 text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-600"}`,children:"صغير"}),e.jsx("button",{onClick:()=>f("md"),className:`px-2 py-1 text-sm rounded-md transition-colors ${N==="md"?"bg-indigo-500 dark:bg-indigo-600 text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-600"}`,children:"وسط"}),e.jsx("button",{onClick:()=>f("lg"),className:`px-2 py-1 text-base rounded-md transition-colors ${N==="lg"?"bg-indigo-500 dark:bg-indigo-600 text-white":"text-slate-600 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-600"}`,children:"كبير"})]})]}),e.jsx("div",{className:`prose dark:prose-invert max-w-none text-slate-700 dark:text-slate-300 leading-loose whitespace-pre-wrap ${k[N]}`,children:m.content}),e.jsx(Fe,{comments:m.comments,onAddComment:T=>r(m.id,T)})]})]})]})},Ve=new Be({apiKey:"AIzaSyA7k3Oh3wbgV7jjOLzzeKd0NFzw12T_deU"});async function qe(t){const a=`بصفتك روائي خبير في كتابة القصص الخيالية باللغة العربية، قم بتأليف قصة طويلة وعميقة (حوالي 700-800 كلمة) بناءً على العنوان التالي: "${t}".

ركز على النقاط التالية:
1.  **تطوير الشخصيات**: أعطِ الشخصيات الرئيسية عمقاً ودوافع واضحة.
2.  **بناء العالم**: صف البيئة والأجواء بتفاصيل غنية تجعل القارئ يغوص في عالم القصة.
3.  **حبكة متصاعدة**: ابدأ بمقدمة هادئة، ثم أدخل الصراع أو الحدث الرئيسي، وصولاً إلى ذروة مثيرة.
4.  **نهاية مرضية**: اختتم القصة بنهاية مؤثرة، حكيمة، أو غير متوقعة، تترك أثراً في نفس القارئ.

يجب أن تكون القصة باللغة العربية الفصحى، ومناسبة لجميع الأعمار.
أرجع القصة فقط كنص عادي بدون أي تنسيق إضافي.`;try{return(await Ve.models.generateContent({model:"gemini-2.5-flash-preview-04-17",contents:a})).text}catch(r){throw console.error("Error generating story from Gemini API:",r),new Error("Failed to generate story content.")}}const Ge=({size:t="h-8 w-8"})=>e.jsx("div",{className:`${t} animate-spin rounded-full border-4 border-slate-500 border-t-indigo-400`,role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),J=({stories:t,onAddStory:a,onEditStory:r})=>{const{id:n}=Q(),s=_(),{user:l}=S(),i=!!n,[g,d]=o.useState(null),[b,c]=o.useState("ai"),[x,h]=o.useState(""),[j,m]=o.useState(""),[N,f]=o.useState(V[0]),[u,w]=o.useState(null),[k,B]=o.useState(!1),[U,C]=o.useState(""),[I,y]=o.useState(null);o.useEffect(()=>{if(i&&t){const p=t.find(v=>v.id===n);if(p){if(p.author!==l){s("/");return}d(p),h(p.title),m(p.content),f(p.category),w(p.coverImage),c("manual")}else s("/")}},[n,t,i,s,l]);const T=p=>{var $;const v=($=p.target.files)==null?void 0:$[0];if(v){if(v.size>4*1024*1024){y("حجم الملف كبير جداً. الرجاء اختيار ملف أصغر من 4 ميجابايت.");return}const O=new FileReader;O.onloadend=()=>{w(O.result),y(null)},O.readAsDataURL(v)}},ee=()=>{w(null);const p=document.getElementById("cover-upload");p&&(p.value="")},te=async p=>{if(p.preventDefault(),y(null),!x.trim()){y("الرجاء إدخال عنوان القصة.");return}if(b==="manual"&&!j.trim()){y("الرجاء كتابة محتوى القصة.");return}if(!u){y("الرجاء رفع صورة غلاف للقصة.");return}B(!0);try{let v="";if(b==="ai"&&!i?(C("جاري كتابة القصة..."),v=await qe(x)):v=j,i&&g&&r){const $={...g,title:x,content:v,category:N,coverImage:u};r($),s(`/story/${g.id}`)}else!i&&a&&(a({title:x,category:N,content:v,coverImage:u}),s("/"))}catch(v){console.error(v),y("فشل في معالجة القصة. الرجاء التأكد من صحة مفتاح الواجهة البرمجية والمحاولة مرة أخرى.")}finally{B(!1),C("")}},se=i?H:Ne,ae=i?"تعديل القصة":"إنشاء قصة جديدة",re=i?"حفظ التعديلات":"أبدِع القصة";return e.jsxs("div",{className:"max-w-2xl mx-auto bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg dark:shadow-xl dark:shadow-slate-950/50 animate-fade-in border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(se,{className:"h-10 w-10 text-indigo-500 dark:text-indigo-400 mx-auto mb-3"}),e.jsx("h1",{className:"text-3xl font-bold",children:ae}),e.jsxs("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:["مرحباً ",e.jsx("span",{className:"font-bold text-indigo-600 dark:text-indigo-300",children:l}),"! ",i?"قم بتعديل تحفتك الفنية.":"اختر طريقتك في الإبداع."]})]}),!i&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-6 border border-slate-200 dark:border-slate-700 p-1 rounded-lg bg-slate-100 dark:bg-slate-900/50",children:[e.jsxs("button",{type:"button",onClick:()=>c("ai"),className:`w-full flex items-center justify-center gap-2 py-2 px-4 rounded-md text-sm font-semibold transition-colors ${b==="ai"?"bg-indigo-600 text-white shadow":"text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:[e.jsx(W,{className:"h-5 w-5"}),e.jsx("span",{children:"إنشاء بالذكاء الاصطناعي"})]}),e.jsxs("button",{type:"button",onClick:()=>c("manual"),className:`w-full flex items-center justify-center gap-2 py-2 px-4 rounded-md text-sm font-semibold transition-colors ${b==="manual"?"bg-indigo-600 text-white shadow":"text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:[e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{children:"كتابة يدوية"})]})]}),e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"عنوان القصة"}),e.jsx("input",{id:"title",type:"text",value:x,onChange:p=>h(p.target.value),placeholder:"مثال: الفارس المفقود في وادي النجوم",className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md py-2 px-4 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition",required:!0})]}),(b==="manual"||i)&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"محتوى القصة"}),e.jsx("textarea",{id:"content",value:j,onChange:p=>m(p.target.value),placeholder:"اكتب قصتك هنا...",className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md py-2 px-4 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition h-64 resize-y",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"تصنيف القصة"}),e.jsx("select",{id:"category",value:N,onChange:p=>f(p.target.value),className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md py-2 px-4 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition",children:V.map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-slate-800 text-slate-900 dark:text-white font-medium",children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"صورة الغلاف"}),u?e.jsxs("div",{className:"mt-2 relative",children:[e.jsx("img",{src:u,alt:"معاينة الغلاف",className:"w-full h-auto max-h-72 object-contain rounded-md bg-slate-100 dark:bg-slate-900/50"}),e.jsx("button",{type:"button",onClick:ee,"aria-label":"إزالة الصورة",className:"absolute top-2 right-2 bg-black/50 text-white rounded-full p-1.5 hover:bg-black/70 transition-colors",children:e.jsx(K,{className:"h-5 w-5"})})]}):e.jsx("div",{className:"mt-2",children:e.jsxs("label",{htmlFor:"cover-upload",className:"flex justify-center px-6 pt-5 pb-6 border-2 border-slate-300 dark:border-slate-600 border-dashed rounded-md cursor-pointer hover:border-indigo-500 transition-colors bg-slate-100/50 dark:bg-slate-700/20 hover:bg-slate-200/50 dark:hover:bg-slate-700/40",children:[e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(ve,{className:"mx-auto h-12 w-12 text-slate-400"}),e.jsx("div",{className:"flex text-sm text-slate-500 dark:text-slate-400",children:e.jsx("p",{className:"pl-1",children:"ارفع ملفًا أو اسحبه وأفلته هنا"})}),e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500",children:"PNG, JPG, WEBP بحد أقصى 4 ميجابايت"})]}),e.jsx("input",{id:"cover-upload",name:"cover-upload",type:"file",className:"sr-only",accept:"image/png, image/jpeg, image/webp",onChange:T})]})})]}),I&&e.jsx("p",{className:"text-red-500 dark:text-red-400 text-sm text-center bg-red-100 dark:bg-red-900/20 p-3 rounded-md",children:I}),e.jsx("button",{type:"submit",disabled:k,className:"w-full flex items-center justify-center gap-3 bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-500 transition-colors disabled:bg-slate-400 dark:disabled:bg-slate-500 disabled:cursor-not-allowed text-lg",children:k?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{size:"h-5 w-5"}),e.jsx("span",{children:U||"جاري المعالجة..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-6 w-6"}),e.jsx("span",{children:re})]})})]})]})},Qe=({stories:t})=>{const{authorName:a}=Q(),r=o.useMemo(()=>t.filter(s=>s.author===a),[t,a]),n=o.useMemo(()=>r.reduce((s,l)=>(s.likes+=l.likedBy.length,s.comments+=l.comments.length,s),{likes:0,comments:0}),[r]);return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800/50 p-8 rounded-lg mb-12 shadow-lg border border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6",children:[e.jsx("div",{className:"bg-indigo-500 rounded-full h-24 w-24 flex items-center justify-center text-white shrink-0",children:e.jsx(A,{className:"h-12 w-12"})}),e.jsxs("div",{className:"text-center sm:text-right",children:[e.jsx("h1",{className:"text-4xl font-bold text-slate-900 dark:text-white",children:a}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-lg",children:"مؤلف في نسيج الحكايات"}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-center sm:justify-start gap-x-6 gap-y-2 text-slate-600 dark:text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-indigo-500 dark:text-indigo-400"}),e.jsx("span",{className:"font-semibold",children:r.length})," قصة"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-red-500 dark:text-red-400"}),e.jsx("span",{className:"font-semibold",children:n.likes})," إعجاب"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-sky-500 dark:text-sky-400"}),e.jsx("span",{className:"font-semibold",children:n.comments})," تعليق"]})]})]})]})}),e.jsxs("h2",{className:"text-3xl font-bold mb-8",children:["قصص بقلم ",a]}),r.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8",children:r.map(s=>e.jsx(D,{story:s},s.id))}):e.jsxs("div",{className:"text-center py-16 px-6 bg-white dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsx(L,{className:"mx-auto h-16 w-16 text-slate-400 dark:text-slate-500 mb-4"}),e.jsxs("h3",{className:"text-xl font-semibold text-slate-700 dark:text-slate-300",children:["لم يقم ",a," بنشر أي قصص بعد."]})]})]})},We=({stories:t})=>{const{bookmarks:a}=S(),r=t.filter(n=>a.includes(n.id));return e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx(M,{className:"h-8 w-8 text-indigo-500 dark:text-indigo-400"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"قائمة القراءة"})]}),r.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8",children:r.map(n=>e.jsx(D,{story:n},n.id))}):e.jsxs("div",{className:"text-center py-16 px-6 bg-white dark:bg-slate-800/50 rounded-lg shadow-sm dark:shadow-none border border-slate-200 dark:border-slate-800",children:[e.jsx(M,{className:"mx-auto h-16 w-16 text-slate-400 dark:text-slate-500 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-slate-700 dark:text-slate-300",children:"قائمة القراءة فارغة"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:"ابحث عن القصص التي تثير اهتمامك وأضفها هنا للعودة إليها لاحقًا."}),e.jsxs(P,{to:"/",className:"mt-6 inline-flex items-center justify-center gap-2 bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-500 transition-transform transform hover:scale-105",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{children:"تصفح القصص"})]})]})]})},Je=()=>{const[t,a]=o.useState(""),{login:r}=S(),n=s=>{s.preventDefault(),t.trim()&&r(t.trim())};return e.jsx("div",{className:"fixed inset-0 bg-slate-100 dark:bg-slate-900 bg-opacity-90 backdrop-blur-sm flex items-center justify-center z-[100]",children:e.jsxs("div",{className:"w-full max-w-sm mx-auto bg-white dark:bg-slate-800 p-8 rounded-lg shadow-xl dark:shadow-slate-950/50 animate-fade-in text-center border border-slate-200 dark:border-slate-700",children:[e.jsx(A,{className:"h-12 w-12 text-indigo-500 dark:text-indigo-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2 text-slate-900 dark:text-white",children:"مرحباً بك في نسيج الحكايات"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-6",children:"الرجاء إدخال اسمك للمتابعة والمشاركة."}),e.jsxs("form",{onSubmit:n,className:"flex flex-col gap-4",children:[e.jsx("input",{type:"text",value:t,onChange:s=>a(s.target.value),placeholder:"اكتب اسمك هنا...",className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md py-2 px-4 text-slate-900 dark:text-white text-center placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition",required:!0,autoFocus:!0}),e.jsx("button",{type:"submit",className:"w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-500 transition-colors disabled:bg-slate-400 dark:disabled:bg-slate-500 disabled:cursor-not-allowed",disabled:!t.trim(),children:"دخول"})]})]})})},Ke=()=>e.jsxs("div",{className:"fixed inset-0 bg-slate-50 dark:bg-slate-900 flex flex-col items-center justify-center z-[200] animate-fade-in",children:[e.jsx("div",{className:"relative",children:e.jsx(L,{className:"h-24 w-24 text-indigo-500 dark:text-indigo-400 animate-float"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-800 dark:text-white mt-6",children:"نسيج الحكايات"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:"... جاري نسج عالم من الخيال ..."})]}),_e=()=>{const{user:t}=S(),[a,r]=z("stories",Ae),[n,s]=o.useState(!0);o.useEffect(()=>{const c=setTimeout(()=>s(!1),2500);return()=>clearTimeout(c)},[]);const l=c=>{if(!t)return;const x={...c,id:Date.now().toString(),author:t,likedBy:[],comments:[]};r(h=>[x,...h])},i=c=>{r(x=>x.map(h=>h.id===c.id?c:h))},g=c=>window.confirm("هل أنت متأكد من أنك تريد حذف هذه القصة؟ لا يمكن التراجع عن هذا الإجراء.")?(r(x=>x.filter(h=>h.id!==c)),!0):!1,d=c=>{if(!t){alert("الرجاء تسجيل الدخول لتتمكن من الإعجاب بالقصة.");return}r(x=>x.map(h=>{if(h.id===c){const m=h.likedBy.includes(t)?h.likedBy.filter(N=>N!==t):[...h.likedBy,t];return{...h,likedBy:m}}return h}))},b=(c,x)=>{if(!t){alert("الرجاء تسجيل الدخول لتتمكن من إضافة تعليق.");return}r(h=>h.map(j=>{if(j.id===c){const m={id:`${c}-${Date.now()}`,author:t,text:x};return{...j,comments:[m,...j.comments]}}return j}))};return n?e.jsx(Ke,{}):t?e.jsxs("div",{className:"min-h-screen",children:[e.jsx(Re,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs(Se,{children:[e.jsx(E,{path:"/",element:e.jsx(Ie,{stories:a})}),e.jsx(E,{path:"/profile/:authorName",element:e.jsx(Qe,{stories:a})}),e.jsx(E,{path:"/reading-list",element:e.jsx(We,{stories:a})}),e.jsx(E,{path:"/story/:id",element:e.jsx(He,{stories:a,onLike:d,onAddComment:b,onDelete:g})}),e.jsx(E,{path:"/create",element:e.jsx(J,{onAddStory:l,stories:a})}),e.jsx(E,{path:"/edit/:id",element:e.jsx(J,{onEditStory:i,stories:a})})]})})]}):e.jsx(Je,{})},Xe=()=>e.jsx(ye,{children:e.jsx(Le,{children:e.jsx(Ee,{children:e.jsx(_e,{})})})}),Z=document.getElementById("root");if(!Z)throw new Error("Could not find root element to mount to");const Ye=Ce.createRoot(Z);Ye.render(e.jsx(Pe.StrictMode,{children:e.jsx(Xe,{})}));
