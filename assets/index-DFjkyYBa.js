import{r as c,j as e,N as L,B as _,C as K,S as q,a as Pe,L as z,H as J,M as ie,E as Ae,u as ze,b as Ee,T as le,c as Te,d as ce,e as B,U as Le,f as $e,g as De,P as de,h as me,V as Oe,i as Re,k as Ue,l as Me,m as xe,n as Fe,o as Ge,p as _e,q as ae,R as Be,X as qe,I as Je,s as Ve,t as He,v as Ke,w as Ye,x as R,y as We,z as Qe,A as Xe}from"./react-DGPIU3CI.js";import{m as G,G as Ze,A as et}from"./vendor-BzMM-lDG.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const Y="hkayat_stories",W="hkayat_users",Q="hkayat_current_user_id",E=["مغامرات","خيال علمي","فانتازيا","غموض","دراما اجتماعية","قصص أطفال","كوميديا","تاريخية","أخلاقية"],tt=()=>({"user-2":{id:"user-2",name:"علي حسن",avatar:"https://i.pravatar.cc/150?u=user-2"},"user-3":{id:"user-3",name:"فاطمة الزهراء",avatar:"https://i.pravatar.cc/150?u=user-3"},"user-4":{id:"user-4",name:"عمر شريف",avatar:"https://i.pravatar.cc/150?u=user-4"}}),U=()=>{const t=localStorage.getItem(W);if(t)return JSON.parse(t);const s=tt();return localStorage.setItem(W,JSON.stringify(s)),s},ue=t=>{localStorage.setItem(W,JSON.stringify(t))},st=t=>{const s=U();return Object.values(s).some(a=>a.name.toLowerCase()===t.toLowerCase())},rt=t=>{const s=U(),a=`user-${Date.now()}`,n={id:a,name:t,avatar:`https://i.pravatar.cc/150?u=${a}`};return s[a]=n,ue(s),n},at=t=>{const s=U();return Object.values(s).find(a=>a.name.toLowerCase()===t.toLowerCase())},X=t=>U()[t],nt=(t,s)=>{const a=U();if(a[t])return a[t].avatar=s,ue(a),a[t]},ot=()=>localStorage.getItem(Q),ne=t=>{t?localStorage.setItem(Q,t):localStorage.removeItem(Q)},ge=c.createContext(void 0),it=({children:t})=>{const[s,a]=c.useState([]),n=c.useCallback(l=>{a(d=>d.filter(x=>x.id!==l))},[]),r=c.useCallback((l,d)=>{const x=`toast-${Date.now()}`,g={id:x,message:l,type:d};a(h=>[g,...h]),setTimeout(()=>{n(x)},4e3)},[n]),i={toasts:s,showToast:r,removeToast:n};return e.jsx(ge.Provider,{value:i,children:t})},$=()=>{const t=c.useContext(ge);if(t===void 0)throw new Error("useToast must be used within a ToastProvider");return t},he=c.createContext(void 0),lt=({children:t})=>{const[s,a]=c.useState(null),[n,r]=c.useState(!0),{showToast:i}=$();c.useEffect(()=>{try{const h=ot();if(h){const b=X(h);a(b||null)}}catch(h){console.error("Failed to load user from storage",h)}finally{r(!1)}},[]);const g={user:s,loading:n,login:async h=>{let b=at(h);if(!b){if(st(h))throw new Error("اسم المستخدم محجوز بالفعل.");b=rt(h)}return ne(b.id),a(b),b},logout:()=>{ne(null),a(null)},updateAvatar:async h=>{if(s)try{const b=nt(s.id,h);b&&(a(b),i("تم تحديث الصورة الرمزية بنجاح!","success"))}catch{i("فشل تحديث الصورة الرمزية.","error")}}};return e.jsx(he.Provider,{value:g,children:t})},T=()=>{const t=c.useContext(he);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},ct=()=>{const{user:t}=T(),s=({isActive:a})=>`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ${a?"bg-amber-500 text-white":"text-gray-300 hover:bg-gray-700 hover:text-white"}`;return e.jsxs("header",{className:"bg-gray-800 shadow-lg sticky top-0 z-50",children:[e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs(L,{to:"/",className:"flex items-center gap-2 text-2xl font-bold text-white",children:[e.jsx(_,{className:"text-amber-400"}),e.jsx("span",{children:"حكايات"})]}),e.jsxs("nav",{className:"hidden md:flex items-center gap-4",children:[e.jsxs(L,{to:"/create",className:s,children:[e.jsx(K,{size:20}),e.jsx("span",{children:"قصة جديدة"})]}),e.jsxs(L,{to:"/generate",className:s,children:[e.jsx(q,{size:20}),e.jsx("span",{children:"توليد بالذكاء الاصطناعي"})]})]}),t&&e.jsxs(L,{to:"/profile",className:"flex items-center gap-2 text-gray-300 hover:text-white transition-colors",children:[e.jsx("span",{children:t.name}),e.jsx("img",{src:t.avatar,alt:"User Avatar",className:"w-8 h-8 rounded-full border-2 border-amber-400 object-cover"})]})]})}),e.jsx("div",{className:"md:hidden bg-gray-800 p-2",children:e.jsxs("nav",{className:"flex justify-around items-center gap-1",children:[e.jsxs(L,{to:"/",className:s,end:!0,children:[e.jsx(_,{size:20})," ",e.jsx("span",{className:"text-xs",children:"الرئيسية"})]}),e.jsxs(L,{to:"/create",className:s,children:[e.jsx(K,{size:20})," ",e.jsx("span",{className:"text-xs",children:"جديدة"})]}),e.jsxs(L,{to:"/generate",className:s,children:[e.jsx(q,{size:20})," ",e.jsx("span",{className:"text-xs",children:"توليد"})]}),e.jsxs(L,{to:"/profile",className:s,children:[e.jsx(Pe,{size:20})," ",e.jsx("span",{className:"text-xs",children:"ملفي"})]})]})})]})},dt=()=>e.jsx("footer",{className:"bg-gray-800 text-gray-400 text-center p-4 mt-8",children:e.jsxs("p",{children:["© ",new Date().getFullYear()," منصة حكايات. كل الحقوق محفوظة."]})}),mt=()=>{const t=U(),s=t["user-2"]||{id:"user-2",name:"علي حسن",avatar:"https://i.pravatar.cc/150?u=user-2"},a=t["user-3"]||{id:"user-3",name:"فاطمة الزهراء",avatar:"https://i.pravatar.cc/150?u=user-3"},n=t["user-4"]||{id:"user-4",name:"عمر شريف",avatar:"https://i.pravatar.cc/150?u=user-4"};return[{id:"story-1",title:"التاجر الأمين والثعلب الماكر",content:'في قديم الزمان، كان هناك تاجر أمين يُدعى "سعيد". كان سعيد يسافر بين المدن لبيع بضاعته. في إحدى رحلاته عبر الغابة، التقى بثعلب ماكر عرض عليه المساعدة في حمل بضاعته مقابل جزء صغير منها. وافق سعيد، لكن الثعلب كان يخطط لسرقة كل شيء. لاحظ سعيد ذكاء الثعلب وشك في نواياه. وعندما وصلوا إلى النهر، طلب سعيد من الثعلب أن يعبر أولاً ليختبر عمق المياه. عندما دخل الثعلب، دفعه سعيد بخفة إلى منتصف النهر وقال: "هذا جزاء الطمع!". تعلم الثعلب درساً قاسياً، وأكمل سعيد رحلته بسلام.',author:s,category:E[8],image:"https://picsum.photos/seed/story-1/1200/600",createdAt:new Date(Date.now()-864e5*2).toISOString(),views:152,likes:[{userId:"user-3",createdAt:new Date().toISOString()},{userId:"user-4",createdAt:new Date().toISOString()}],comments:[{id:"comment-1",text:"قصة رائعة ومعبرة!",user:a,createdAt:new Date().toISOString()}]},{id:"story-2",title:"نجمة السماء الحزينة",content:'كانت هناك نجمة صغيرة في السماء تشعر بالوحدة. كل النجوم الأخرى كانت تتلألأ بسعادة، لكنها كانت تشعر بأن لا أحد يلاحظها. في ليلة صافية، رآها طفل صغير من نافذة غرفته وقال لأمه: "انظري يا أمي، تلك النجمة الصغيرة هي أجمل نجمة في السماء لأنها تذكرني بكِ، فريدة ومميزة". سمعت النجمة كلام الطفل وشعرت بسعادة غامرة. ومنذ ذلك اليوم، أصبحت تتلألأ أكثر من أي نجمة أخرى، عالمة أن لكل شخص مكانه الخاص في هذا الكون.',author:a,category:E[5],image:"https://picsum.photos/seed/story-2/1200/600",createdAt:new Date(Date.now()-864e5).toISOString(),views:289,likes:[{userId:"user-2",createdAt:new Date().toISOString()},{userId:"user-4",createdAt:new Date().toISOString()}],comments:[{id:"comment-2",text:"قصة جميلة جداً، أثرت فيّ.",user:s,createdAt:new Date().toISOString()},{id:"comment-3",text:"أحببت الفكرة!",user:n,createdAt:new Date().toISOString()}]}]},D=()=>{const t=localStorage.getItem(Y);if(t)return JSON.parse(t).map(n=>({...n,author:X(n.author.id)||n.author,comments:n.comments.map(r=>({...r,user:X(r.user.id)||r.user}))}));const s=mt();return localStorage.setItem(Y,JSON.stringify(s)),s},M=t=>{localStorage.setItem(Y,JSON.stringify(t))},fe=async()=>new Promise(t=>{setTimeout(()=>{t(D())},500)}),pe=async t=>new Promise(s=>{setTimeout(()=>{const a=D(),n=a.find(r=>r.id===t);n&&(n.views+=1,M(a)),s(n)},300)}),be=async(t,s)=>new Promise(a=>{setTimeout(()=>{const n=D(),r={id:`story-${Date.now()}`,title:t.title,content:t.content,category:t.category,image:t.image,author:s,createdAt:new Date().toISOString(),views:0,likes:[],comments:[]};n.unshift(r),M(n),a(r)},500)}),xt=async(t,s,a)=>new Promise((n,r)=>{setTimeout(()=>{const i=D(),l=i.findIndex(d=>d.id===t);if(l===-1)return r(new Error("لم يتم العثور على القصة"));if(i[l].author.id!==a)return r(new Error("غير مصرح لك بتعديل هذه القصة"));i[l]={...i[l],title:s.title,content:s.content,category:s.category,image:s.image!==void 0?s.image:i[l].image},M(i),n(i[l])},500)}),je=async(t,s)=>new Promise((a,n)=>{setTimeout(()=>{const r=D(),i=r.findIndex(l=>l.id===t);if(i===-1)return n(new Error("لم يتم العثور على القصة"));if(r[i].author.id!==s)return n(new Error("غير مصرح لك بحذف هذه القصة"));r.splice(i,1),M(r),a()},300)}),ut=async(t,s)=>new Promise((a,n)=>{setTimeout(()=>{const r=D(),i=r.findIndex(x=>x.id===t);if(i===-1)return n(new Error("Story not found"));const l=r[i],d=l.likes.findIndex(x=>x.userId===s);d>-1?l.likes.splice(d,1):l.likes.push({userId:s,createdAt:new Date().toISOString()}),r[i]=l,M(r),a(l)},200)}),gt=async(t,s,a)=>new Promise((n,r)=>{setTimeout(()=>{const i=D(),l=i.findIndex(g=>g.id===t);if(l===-1)return r(new Error("Story not found"));const d=i[l],x={id:`comment-${Date.now()}`,text:s,user:a,createdAt:new Date().toISOString()};d.comments.push(x),i[l]=d,M(i),n(d)},400)}),oe=({story:t})=>{const{user:s}=T(),a=s?t.likes.some(r=>r.userId===s.id):!1,n=r=>{const i=new Date(r),l=Math.floor((new Date().getTime()-i.getTime())/1e3);let d=l/31536e3;return d>1?`قبل ${Math.floor(d)} سنوات`:(d=l/2592e3,d>1?`قبل ${Math.floor(d)} أشهر`:(d=l/86400,d>1?`قبل ${Math.floor(d)} أيام`:(d=l/3600,d>1?`قبل ${Math.floor(d)} ساعات`:(d=l/60,d>1?`قبل ${Math.floor(d)} دقائق`:`قبل ${Math.floor(l)} ثوان`))))};return e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-amber-500/20 flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx(z,{to:`/story/${t.id}`,children:e.jsx("img",{className:"w-full h-48 object-cover",src:t.image||`https://picsum.photos/seed/${t.id}/1200/600`,alt:t.title})}),e.jsx(z,{to:`/?category=${encodeURIComponent(t.category)}`,className:"absolute top-2 left-2 bg-amber-500 text-white text-xs font-bold px-2 py-1 rounded-full hover:bg-amber-600 transition-colors",children:t.category})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-grow",children:[e.jsx(z,{to:`/story/${t.id}`,children:e.jsx("h3",{className:"text-xl font-bold text-white hover:text-amber-400 transition-colors truncate",children:t.title})}),e.jsxs("div",{className:"flex items-center mt-2 text-gray-400 text-sm",children:[e.jsx("img",{src:t.author.avatar,alt:t.author.name,className:"w-6 h-6 rounded-full mr-2 border border-gray-600 object-cover"}),e.jsx("span",{children:t.author.name}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:n(t.createdAt)})]}),e.jsx("p",{className:"text-gray-300 mt-3 h-20 overflow-hidden text-ellipsis flex-grow",children:t.content}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 flex justify-between items-center text-gray-400",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{size:18,className:a?"text-red-500 fill-current":""}),e.jsx("span",{children:t.likes.length})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{size:18}),e.jsx("span",{children:t.comments.length})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ae,{size:18}),e.jsx("span",{children:t.views})]})]}),e.jsx(z,{to:`/story/${t.id}`,className:"text-sm font-semibold text-amber-400 hover:text-amber-300",children:"اقرأ المزيد →"})]})]})]})},ht=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden animate-pulse",children:[e.jsx("div",{className:"w-full h-48 bg-gray-700"}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-3/4 mb-4"}),e.jsxs("div",{className:"flex items-center mt-2 text-gray-400 text-sm",children:[e.jsx("div",{className:"w-6 h-6 rounded-full mr-2 bg-gray-700"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-1/4"})]}),e.jsxs("div",{className:"space-y-2 mt-3",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-5/6"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-5 bg-gray-700 rounded w-12"}),e.jsx("div",{className:"h-5 bg-gray-700 rounded w-12"})]}),e.jsx("div",{className:"h-5 bg-gray-700 rounded w-20"})]})]})]}),ft={initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}},pt={type:"tween",ease:"anticipate",duration:.5},O=({children:t})=>e.jsx(G.div,{initial:"initial",animate:"in",exit:"out",variants:ft,transition:pt,children:t}),bt=()=>{const[t,s]=c.useState([]),[a,n]=c.useState(!0),[r,i]=c.useState(null),[l,d]=ze(),x=l.get("search")||"",g=l.get("category")||"الكل";c.useEffect(()=>{(async()=>{try{n(!0);const u=await fe();s(u)}catch{i("فشل في تحميل القصص. الرجاء المحاولة مرة أخرى.")}finally{n(!1)}})()},[]);const h=o=>{d(u=>(o==="الكل"?u.delete("category"):u.set("category",o),u))},b=o=>{const u=o.target.value;d(m=>(u?m.set("search",u):m.delete("search"),m))},C=c.useMemo(()=>t.filter(o=>g==="الكل"?!0:o.category===g).filter(o=>{if(!x)return!0;const u=x.toLowerCase();return o.title.toLowerCase().includes(u)||o.author.name.toLowerCase().includes(u)}),[t,x,g]),v=[...C].sort((o,u)=>u.views+u.likes.length*5-(o.views+o.likes.length*5)).slice(0,3),j=C.filter(o=>!v.find(u=>u.id===o.id));if(r)return e.jsx("div",{className:"text-center text-red-500",children:r});const S={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},k={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsx(O,{children:e.jsxs("div",{className:"space-y-12",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"ابحث عن قصة أو مؤلف...",value:x,onChange:b,className:"w-full bg-gray-800 border border-gray-700 rounded-full py-3 pr-12 pl-4 text-white focus:outline-none focus:ring-2 focus:ring-amber-500"}),e.jsx("div",{className:"absolute top-1/2 right-4 transform -translate-y-1/2 text-gray-400",children:e.jsx(Ee,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(le,{size:20,className:"text-amber-400"}),e.jsx("button",{onClick:()=>h("الكل"),className:`px-3 py-1 text-sm rounded-full transition-colors ${g==="الكل"?"bg-amber-500 text-white":"bg-gray-700 hover:bg-gray-600"}`,children:"الكل"}),E.map(o=>e.jsx("button",{onClick:()=>h(o),className:`px-3 py-1 text-sm rounded-full transition-colors ${g===o?"bg-amber-500 text-white":"bg-gray-700 hover:bg-gray-600"}`,children:o},o))]})]}),a?e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-48 bg-gray-700 rounded-md animate-pulse mb-6"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[...Array(6)].map((o,u)=>e.jsx(ht,{},u))})]}):e.jsxs(e.Fragment,{children:[v.length>0&&g==="الكل"&&!x&&e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-amber-400 border-b-2 border-amber-400 pb-2 mb-6",children:"الأكثر رواجاً"}),e.jsx(G.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",variants:S,initial:"hidden",animate:"visible",children:v.map(o=>e.jsx(G.div,{variants:k,children:e.jsx(oe,{story:o})},o.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white pb-2 mb-6",children:x?"نتائج البحث":g!=="الكل"?`قصص في تصنيف "${g}"`:"أحدث القصص"}),j.length>0?e.jsx(G.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",variants:S,initial:"hidden",animate:"visible",children:j.map(o=>e.jsx(G.div,{variants:k,children:e.jsx(oe,{story:o})},o.id))}):e.jsx("div",{className:"text-center py-10 bg-gray-800 rounded-lg",children:e.jsx("p",{className:"text-gray-400",children:"لم يتم العثور على قصص تطابق المعايير المحددة."})})]})]})]})})},P=({size:t="8"})=>{const s=`h-${t} w-${t}`;return e.jsx("div",{className:`animate-spin rounded-full ${s} border-b-2 border-t-2 border-amber-500`})},jt=({storyUrl:t,storyTitle:s})=>{const{showToast:a}=$(),n=()=>{navigator.clipboard.writeText(t).then(()=>{a("تم نسخ رابط القصة بنجاح!","success")}).catch(()=>{a("فشل نسخ الرابط.","error")})};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-300",children:"مشاركة:"}),e.jsx("button",{onClick:n,className:"p-2 rounded-full bg-gray-700 hover:bg-amber-500 text-white transition-colors",title:"نسخ الرابط",children:e.jsx(Te,{size:18})}),e.jsx("a",{href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(t)}&text=${encodeURIComponent(s)}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full bg-gray-700 hover:bg-amber-500 text-white transition-colors",title:"مشاركة على تويتر",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 4s-.7 2.1-2 3.4c1.6 1.4 3.3 4.9 3 7.1 0 .8-.2 1.5-.4 2.1-.7 1.9-2.2 3.2-4.1 3.8-1.5.5-3.1.6-4.6.4-1.8-.2-3.4-.9-4.8-2-1.1-.9-2-2.1-2.6-3.4-.6-1.3-.9-2.8-.9-4.3 0-2.6 1.1-5 2.8-6.6.3-.3.6-.6.9-.8.4-.3.8-.5 1.3-.7 1.5-.6 3.1-.9 4.7-.9 1.1 0 2.2.2 3.2.5.3.1.6.2.8.3.2.1.4.2.6.3.3.1.5.2.7.3.2.1.3.2.4.2z"})})}),e.jsx("a",{href:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full bg-gray-700 hover:bg-amber-500 text-white transition-colors",title:"مشاركة على فيسبوك",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"})})})]})},yt=()=>{const[t,s]=c.useState(0),a=()=>{const n=document.getElementById("story-content");if(!n)return;const{top:r,height:i}=n.getBoundingClientRect(),l=i-window.innerHeight;if(l<=0){s(r<0?100:0);return}const x=Math.max(0,-r)/l*100;s(Math.min(100,x))};return c.useEffect(()=>(window.addEventListener("scroll",a),a(),()=>window.removeEventListener("scroll",a)),[]),e.jsx("div",{className:"fixed top-0 left-0 right-0 h-1 z-50",children:e.jsx("div",{className:"bg-amber-500 h-full",style:{width:`${t}%`}})})},wt=()=>{const{id:t}=ce(),{user:s}=T(),{showToast:a}=$(),n=B(),[r,i]=c.useState(null),[l,d]=c.useState(!0),[x,g]=c.useState(null),[h,b]=c.useState(""),[C,v]=c.useState(!1),[j,S]=c.useState(!1),[k,o]=c.useState(!1),[u,m]=c.useState(!1),[f,N]=c.useState(!1),[y,w]=c.useState(!1),A=c.useRef(null),F=c.useCallback(async()=>{if(t)try{const p=await pe(t);p?i(p):g("لم يتم العثور على القصة.")}catch{g("فشل في تحميل القصة.")}finally{d(!1)}},[t]);c.useEffect(()=>(d(!0),F(),()=>{window.speechSynthesis&&window.speechSynthesis.speaking&&window.speechSynthesis.cancel()}),[F]);const we=async()=>{if(!(!t||C||!s)){v(!0);try{const p=await ut(t,s.id);i(p)}catch{a("فشل تسجيل الإعجاب","error")}finally{v(!1)}}},ve=async p=>{if(p.preventDefault(),!(!t||!h.trim()||j||!s)){S(!0);try{const I=await gt(t,h,s);i(I),b(""),a("تم إضافة تعليقك بنجاح","success")}catch{a("فشل إضافة التعليق","error")}finally{S(!1)}}},Ne=async()=>{if(!(!t||!s||u)){m(!0);try{await je(t,s.id),a("تم حذف القصة بنجاح","success"),n("/")}catch(p){const I=p instanceof Error?p.message:"فشل حذف القصة";a(I,"error"),m(!1),o(!1)}}},Z=p=>new Date(p).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"}),Se=p=>{const se=p.split(/\s+/).length;return Math.ceil(se/150)},V=typeof window<"u"&&"speechSynthesis"in window,Ce=()=>{if(!r||!V)return;const p=()=>{const I=new SpeechSynthesisUtterance(`${r.title}. ${r.content}`);A.current=I;const re=window.speechSynthesis.getVoices().find(H=>H.lang.startsWith("ar"));re&&(I.voice=re),I.lang="ar-SA",I.onend=()=>{N(!1),w(!1),A.current=null},I.onerror=H=>{console.error("Speech synthesis error",H),a("حدث خطأ أثناء تشغيل الصوت.","error"),N(!1),w(!1),A.current=null},window.speechSynthesis.speak(I),N(!0),w(!1)};window.speechSynthesis.speaking&&!y?(window.speechSynthesis.pause(),w(!0)):window.speechSynthesis.speaking&&y?(window.speechSynthesis.resume(),w(!1)):window.speechSynthesis.getVoices().length===0?window.speechSynthesis.onvoiceschanged=()=>{p(),window.speechSynthesis.onvoiceschanged=null}:p()},ke=()=>{V&&window.speechSynthesis.speaking&&window.speechSynthesis.cancel(),N(!1),w(!1)};if(l)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(P,{size:"16"})});if(x||!r)return e.jsx("div",{className:"text-center text-red-400 text-2xl mt-10",children:x||"لم يتم العثور على القصة"});const ee=s?r.likes.some(p=>p.userId===s.id):!1,Ie=s?.id===r.author.id,te=Se(r.content);return e.jsxs(O,{children:[e.jsx(yt,{}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 md:p-8 lg:p-12",children:[e.jsx("div",{className:"mb-4",children:e.jsxs(z,{to:`/?category=${encodeURIComponent(r.category)}`,className:"inline-flex items-center gap-2 bg-amber-500/10 text-amber-400 text-sm font-bold px-3 py-1 rounded-full hover:bg-amber-500/20 transition-colors",children:[e.jsx(le,{size:14})," ",r.category]})}),e.jsxs("div",{className:"md:flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold text-white mb-4",children:r.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 text-gray-400 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:16}),e.jsx("span",{children:r.author.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{size:16}),e.jsx("span",{children:Z(r.createdAt)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{size:16}),e.jsxs("span",{children:[te," ",te>2?"دقائق":"دقيقة"," قراءة"]})]})]})]}),Ie&&e.jsxs("div",{className:"flex items-center gap-2 mt-4 md:mt-0 flex-shrink-0",children:[e.jsxs(z,{to:`/story/${r.id}/edit`,className:"flex items-center gap-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(de,{size:18})," ",e.jsx("span",{children:"تعديل"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(me,{size:18})," ",e.jsx("span",{children:"حذف"})]})]})]}),r.image&&e.jsx("img",{src:r.image,alt:r.title,className:"w-full h-auto max-h-[500px] object-cover rounded-lg mb-8 shadow-lg"}),e.jsx("div",{id:"story-content",className:"prose prose-invert prose-lg max-w-none text-gray-200 leading-relaxed whitespace-pre-wrap",children:r.content}),e.jsxs("div",{className:"mt-8 pt-6 border-t-2 border-gray-700 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("button",{onClick:we,disabled:C||!s,className:`flex items-center gap-2 text-lg font-semibold transition-transform duration-200 ease-in-out hover:scale-110 ${ee?"text-red-500":"text-gray-300 hover:text-white"}`,children:[e.jsx(J,{size:24,className:ee?"fill-current":""}),e.jsxs("span",{children:[r.likes.length," إعجاب"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-lg text-gray-300",children:[e.jsx(ie,{size:24}),e.jsxs("span",{children:[r.comments.length," تعليق"]})]})]}),e.jsx(jt,{storyUrl:window.location.href,storyTitle:r.title})]}),V&&e.jsxs("div",{className:"mt-8 pt-6 border-t-2 border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-bold text-amber-400 mb-4 flex items-center gap-2",children:[e.jsx(Oe,{}),e.jsx("span",{children:"الاستماع للقصة"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 bg-amber-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-amber-600 transition-colors",children:[f&&!y?e.jsx(Re,{size:18}):e.jsx(Ue,{size:18}),e.jsx("span",{children:f&&!y?"إيقاف مؤقت":y?"استئناف":"تشغيل"})]}),e.jsxs("button",{onClick:ke,disabled:!f,className:"flex items-center gap-2 bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-500 transition-colors disabled:bg-gray-700 disabled:cursor-not-allowed",children:[e.jsx(Me,{size:18}),e.jsx("span",{children:"إيقاف"})]})]})]}),s&&e.jsxs("div",{className:"mt-8 pt-6 border-t-2 border-gray-700",children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"التعليقات"}),e.jsxs("form",{onSubmit:ve,className:"flex gap-2 mb-6",children:[e.jsx("img",{src:s.avatar,alt:"your avatar",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("input",{type:"text",value:h,onChange:p=>b(p.target.value),placeholder:"أضف تعليقاً...",className:"flex-grow bg-gray-700 border border-gray-600 rounded-full py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-amber-500",disabled:j}),e.jsx("button",{type:"submit",className:"bg-amber-500 text-white rounded-full p-3 hover:bg-amber-600 disabled:bg-gray-500 transition-colors",disabled:j||!h.trim(),children:j?e.jsx(P,{size:"5"}):e.jsx(xe,{size:20})})]}),e.jsx("div",{className:"space-y-4",children:r.comments.slice().reverse().map(p=>e.jsxs("div",{className:"flex gap-3 bg-gray-700/50 p-3 rounded-lg",children:[e.jsx("img",{src:p.user.avatar,alt:p.user.name,className:"w-10 h-10 rounded-full mt-1 object-cover"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"font-bold text-amber-400",children:p.user.name}),e.jsx("span",{className:"text-xs text-gray-400",children:Z(p.createdAt)})]}),e.jsx("p",{className:"text-gray-200",children:p.text})]})]},p.id))})]})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[100] transition-opacity",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl p-8 max-w-sm w-full animate-fade-in",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"تأكيد الحذف"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"هل أنت متأكد أنك تريد حذف هذه القصة؟ لا يمكن التراجع عن هذا الإجراء."}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>o(!1),className:"py-2 px-4 bg-gray-600 rounded-md hover:bg-gray-500 transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:Ne,disabled:u,className:"py-2 px-4 bg-red-600 rounded-md hover:bg-red-700 disabled:bg-red-800 flex items-center gap-2 transition-colors",children:[u&&e.jsx(P,{size:"5"}),"نعم، احذف"]})]})]})})]})]})},vt=()=>{const[t,s]=c.useState(""),[a,n]=c.useState(""),[r,i]=c.useState(E[0]),[l,d]=c.useState(void 0),[x,g]=c.useState(null),[h,b]=c.useState(!1),C=B(),{user:v}=T(),{showToast:j}=$(),S=o=>{const u=o.target.files?.[0];if(u){const m=new FileReader;m.onloadend=()=>{const f=m.result;d(f),g(f)},m.readAsDataURL(u)}},k=async o=>{if(o.preventDefault(),!v){j("يجب عليك تسجيل الدخول أولاً لنشر قصة.","error");return}if(!t.trim()||!a.trim()||!r){j("جميع الحقول (العنوان، المحتوى، التصنيف) مطلوبة.","error");return}b(!0);try{const u=await be({title:t,content:a,category:r,image:l},v);j("تم نشر قصتك بنجاح!","success"),C(`/story/${u.id}`)}catch{j("فشل في نشر القصة. الرجاء المحاولة مرة أخرى.","error"),b(!1)}};return e.jsx(O,{children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-gray-800 p-8 rounded-lg shadow-xl",children:[e.jsx("h1",{className:"text-3xl font-bold text-amber-400 mb-6",children:"اكتب قصتك الجديدة"}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-lg font-medium text-gray-300 mb-2",children:"عنوان القصة"}),e.jsx("input",{type:"text",id:"title",value:t,onChange:o=>s(o.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-amber-500",placeholder:"مثال: الأسد الشجاع والفأر الصغير",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-lg font-medium text-gray-300 mb-2",children:"تصنيف القصة"}),e.jsx("select",{id:"category",value:r,onChange:o=>i(o.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-amber-500",required:!0,children:E.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-lg font-medium text-gray-300 mb-2",children:"محتوى القصة"}),e.jsx("textarea",{id:"content",value:a,onChange:o=>n(o.target.value),rows:15,className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-amber-500",placeholder:"كان يا مكان في قديم الزمان...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"image",className:"block text-lg font-medium text-gray-300 mb-2",children:"صورة القصة (اختياري)"}),e.jsx("input",{type:"file",id:"image",onChange:S,accept:"image/*",className:"w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-amber-50 file:text-amber-700 hover:file:bg-amber-100"}),x&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:x,alt:"Preview",className:"max-w-xs max-h-48 rounded-lg shadow-md"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:h,className:"flex items-center justify-center gap-2 bg-amber-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-amber-600 transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed",children:h?e.jsx(P,{size:"6"}):"انشر القصة"})})]})]})})},Nt=new Ze({apiKey:"AIzaSyARVpPfEigrWISzW5NKKcNZGsrKGl5M4cc"}),St=async t=>{try{const s=E.join(", "),a=`Based on the following idea: "${t}", generate a short story in Arabic. Provide the response as a single JSON object with three keys: "title" (in Arabic), "content" (in Arabic), and "category". For the "category", choose the most relevant one from this list: [${s}]. Do not include any other text or markdown formatting.`;let r=(await Nt.models.generateContent({model:"gemini-2.5-flash-preview-04-17",contents:a,config:{responseMimeType:"application/json",temperature:.7}})).text.trim();const i=/^```(\w*)?\s*\n?(.*?)\n?\s*```$/s,l=r.match(i);l&&l[2]&&(r=l[2].trim());const d=JSON.parse(r);if(d.title&&d.content&&d.category){const x=E.find(g=>g.toLowerCase()===d.category.toLowerCase());return{title:d.title,content:d.content,category:x||E[0]}}else throw new Error("Invalid JSON structure in AI response.")}catch(s){throw console.error("Error generating story with Gemini:",s),new Error("فشل توليد القصة. الرجاء المحاولة مرة أخرى.")}},Ct=()=>{const[t,s]=c.useState(""),[a,n]=c.useState(""),[r,i]=c.useState(""),[l,d]=c.useState(""),[x,g]=c.useState(!1),[h,b]=c.useState(!1),C=B(),{user:v}=T(),{showToast:j}=$(),S=async()=>{if(!t.trim()){j("الرجاء إدخال فكرة للقصة.","error");return}g(!0),i(""),n(""),d("");try{const o=await St(t);n(o.title),i(o.content),d(o.category),j("تم توليد القصة بنجاح!","success")}catch(o){const u=o instanceof Error?o.message:"حدث خطأ غير متوقع.";j(u,"error")}finally{g(!1)}},k=async()=>{if(!v){j("يجب عليك تسجيل الدخول أولاً لنشر قصة.","error");return}if(!(!a.trim()||!r.trim()||!l)){b(!0);try{const o={title:a,content:r,category:l,image:`https://picsum.photos/seed/${Date.now()}/1200/600`},u=await be(o,v);j("تم نشر قصتك المولدة بنجاح!","success"),C(`/story/${u.id}`)}catch{j("فشل في نشر القصة.","error"),b(!1)}}};return e.jsx(O,{children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-gray-800 p-8 rounded-lg shadow-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"mx-auto text-amber-400 h-12 w-12"}),e.jsx("h1",{className:"text-3xl font-bold text-amber-400 mt-4 mb-2",children:"توليد قصة بالذكاء الاصطناعي"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"اكتب فكرة بسيطة، ودع السحر يبدأ!"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("textarea",{value:t,onChange:o=>s(o.target.value),rows:3,className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-amber-500",placeholder:"مثال: قطة صغيرة تحلم بأن تصبح رائدة فضاء..."}),e.jsx("button",{onClick:S,disabled:x||!1,className:"w-full flex items-center justify-center gap-2 bg-amber-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-amber-600 transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed",children:x?e.jsx(P,{size:"6"}):e.jsxs(e.Fragment,{children:[e.jsx(q,{size:20})," ",e.jsx("span",{children:"ولّد القصة"})]})}),!1]}),x&&e.jsxs("div",{className:"text-center my-8",children:[e.jsx(P,{size:"12"}),e.jsx("p",{className:"text-gray-400 mt-4",children:"جاري كتابة القصة... قد يستغرق هذا بعض الوقت."})]}),r&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-700 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"القصة المولّدة"}),e.jsxs("div",{className:"space-y-4 bg-gray-900/50 p-6 rounded-lg",children:[e.jsx("input",{type:"text",value:a,onChange:o=>n(o.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-white font-bold text-xl focus:outline-none focus:ring-2 focus:ring-amber-500"}),e.jsxs("div",{className:"text-sm text-amber-400",children:["التصنيف المقترح: ",e.jsx("strong",{children:l})]}),e.jsx("textarea",{value:r,onChange:o=>i(o.target.value),rows:15,className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-white leading-relaxed focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsxs("button",{onClick:()=>{i(""),n(""),s("")},disabled:h,className:"flex items-center justify-center gap-2 bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-500 transition-colors",children:[e.jsx(Fe,{size:20})," ",e.jsx("span",{children:"البدء من جديد"})]}),e.jsx("button",{onClick:k,disabled:h,className:"flex items-center justify-center gap-2 bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-500",children:h?e.jsx(P,{size:"6"}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{size:20})," ",e.jsx("span",{children:"نشر القصة"})]})})]})]})]})})},kt=()=>{const{user:t,logout:s,updateAvatar:a}=T(),{showToast:n}=$(),r=B(),[i,l]=c.useState([]),[d,x]=c.useState(!0),g=c.useRef(null);c.useEffect(()=>{(async()=>{x(!0);try{const f=await fe();l(f)}catch(f){console.error("Failed to load stories for profile",f)}finally{x(!1)}})()},[]);const h=()=>{s(),r("/")},b=()=>{g.current?.click()},C=async m=>{const f=m.target.files?.[0];if(f){const N=new FileReader;N.onloadend=async()=>{const y=N.result;await a(y)},N.readAsDataURL(f)}},v=async m=>{if(t&&window.confirm("هل أنت متأكد أنك تريد حذف هذه القصة؟"))try{await je(m,t.id),l(f=>f.filter(N=>N.id!==m)),n("تم حذف القصة بنجاح","success")}catch(f){const N=f instanceof Error?f.message:"فشل حذف القصة.";n(N,"error")}};if(d)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(P,{size:"16"})});if(!t)return e.jsx("p",{className:"text-center mt-10",children:"الرجاء تسجيل الدخول لعرض الملف الشخصي."});const j=i.filter(m=>m.author.id===t.id),S=i.filter(m=>m.likes.some(f=>f.userId===t.id)),k=i.filter(m=>m.comments.some(f=>f.user.id===t.id)),o=({story:m,isAuthor:f})=>e.jsx("div",{className:"block bg-gray-800 p-3 rounded-lg hover:bg-gray-700 transition-colors group",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs(z,{to:`/story/${m.id}`,className:"flex items-center gap-3 flex-grow min-w-0",children:[e.jsx("img",{src:m.image||`https://picsum.photos/seed/${m.id}/200/200`,alt:m.title,className:"w-14 h-14 rounded-md object-cover flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-bold text-white truncate",children:m.title}),e.jsxs("p",{className:"text-sm text-gray-400",children:["بواسطة ",f?"أنت":m.author.name]})]})]}),f&&e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(z,{to:`/story/${m.id}/edit`,className:"p-2 rounded-full hover:bg-blue-500/20 text-blue-400 transition-colors",children:e.jsx(de,{size:18})}),e.jsx("button",{onClick:()=>v(m.id),className:"p-2 rounded-full hover:bg-red-500/20 text-red-400 transition-colors",children:e.jsx(me,{size:18})})]})]})}),u=({icon:m,text:f,ctaText:N,ctaLink:y})=>e.jsxs("div",{className:"text-center py-8 px-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 flex items-center justify-center bg-gray-700/50 rounded-full text-amber-400 mb-4",children:m}),e.jsx("p",{className:"text-gray-400 mb-4",children:f}),e.jsxs(z,{to:y,className:"inline-flex items-center gap-2 bg-amber-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-amber-600 transition-colors",children:[e.jsx(K,{size:18}),e.jsx("span",{children:N})]})]});return e.jsx(O,{children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl p-8 mb-8 flex flex-col md:flex-row items-center gap-8",children:[e.jsxs("div",{className:"relative group cursor-pointer",onClick:b,children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-32 h-32 rounded-full border-4 border-amber-400 object-cover group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ge,{className:"text-white h-8 w-8"})}),e.jsx("input",{type:"file",ref:g,onChange:C,className:"hidden",accept:"image/*"})]}),e.jsxs("div",{className:"flex-grow text-center md:text-right",children:[e.jsx("h1",{className:"text-4xl font-bold text-white",children:t.name}),e.jsx("p",{className:"text-lg text-gray-300 mt-1",children:"مرحباً بك في صفحتك الشخصية"})]}),e.jsxs("button",{onClick:h,className:"mt-4 md:mt-0 flex items-center gap-2 bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(_e,{size:20}),e.jsx("span",{children:"تسجيل الخروج"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsxs("h3",{className:"text-2xl font-bold text-amber-400 mb-4 flex items-center gap-2",children:[e.jsx(_,{})," قصصي"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:j.length>0?j.map(m=>e.jsx(o,{story:m,isAuthor:!0},`my-${m.id}`)):e.jsx(u,{icon:e.jsx(_,{size:24}),text:"لم تقم بنشر أي قصة بعد.",ctaText:"اكتب قصتك الأولى",ctaLink:"/create"})})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsxs("h3",{className:"text-2xl font-bold text-amber-400 mb-4 flex items-center gap-2",children:[e.jsx(J,{className:"text-red-500"})," أعجبني"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:S.length>0?S.map(m=>e.jsx(o,{story:m,isAuthor:m.author.id===t.id},`liked-${m.id}`)):e.jsx(u,{icon:e.jsx(J,{size:24}),text:"لم تعجب بأي قصة بعد.",ctaText:"تصفح القصص",ctaLink:"/"})})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsxs("h3",{className:"text-2xl font-bold text-amber-400 mb-4 flex items-center gap-2",children:[e.jsx(ae,{className:"text-blue-400"})," تعليقاتي"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:[...new Map(k.map(m=>[m.id,m])).values()].length>0?[...new Map(k.map(m=>[m.id,m])).values()].map(m=>e.jsx(o,{story:m,isAuthor:m.author.id===t.id},`commented-${m.id}`)):e.jsx(u,{icon:e.jsx(ae,{size:24}),text:"لم تعلق على أي قصة بعد.",ctaText:"تصفح القصص",ctaLink:"/"})})]})]})]})})},It=()=>{const[t,s]=c.useState(""),[a,n]=c.useState(null),[r,i]=c.useState(!1),{login:l}=T(),d=async x=>{if(x.preventDefault(),!t.trim()){n("الرجاء إدخال اسمك.");return}i(!0),n(null);try{await l(t)}catch(g){n(g instanceof Error?g.message:"حدث خطأ ما."),i(!1)}};return e.jsx(O,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-gray-800 p-8 rounded-2xl shadow-2xl shadow-amber-500/10 text-center",children:[e.jsx(_,{className:"mx-auto text-amber-400 h-16 w-16 mb-4"}),e.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"مرحباً في حكايات"}),e.jsx("p",{className:"text-gray-300 mb-8",children:"سجّل اسمك للمتابعة أو إنشاء حساب جديد"}),e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"sr-only",children:"الاسم"}),e.jsx("input",{id:"name",type:"text",value:t,onChange:x=>s(x.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md py-3 px-4 text-white text-center text-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition",placeholder:"اكتب اسمك هنا",required:!0})]}),a&&e.jsx("p",{className:"text-red-400",children:a}),e.jsx("button",{type:"submit",disabled:r,className:"w-full flex items-center justify-center gap-2 bg-amber-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-amber-600 transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed",children:r?e.jsx(P,{size:"6"}):"دخول / تسجيل"})]})]})})})},Pt=()=>{const{id:t}=ce(),s=B(),{user:a}=T(),{showToast:n}=$(),[r,i]=c.useState(null),[l,d]=c.useState(""),[x,g]=c.useState(""),[h,b]=c.useState(""),[C,v]=c.useState(void 0),[j,S]=c.useState(null),[k,o]=c.useState(!0),[u,m]=c.useState(!1);c.useEffect(()=>{if(!t||!a){s("/");return}(async()=>{try{const w=await pe(t);w?w.author.id!==a.id?(n("غير مصرح لك بتعديل هذه القصة.","error"),s(`/story/${t}`)):(i(w),d(w.title),g(w.content),b(w.category),v(w.image),S(w.image||null)):(n("لم يتم العثور على القصة.","error"),s("/"))}catch{n("فشل في تحميل بيانات القصة.","error")}finally{o(!1)}})()},[t,a,s,n]);const f=y=>{const w=y.target.files?.[0];if(w){const A=new FileReader;A.onloadend=()=>{const F=A.result;v(F),S(F)},A.readAsDataURL(w)}},N=async y=>{if(y.preventDefault(),!(!t||!a)){if(!l.trim()||!x.trim()||!h){n("جميع الحقول (العنوان، المحتوى، التصنيف) مطلوبة.","error");return}m(!0);try{await xt(t,{title:l,content:x,category:h,image:C},a.id),n("تم تحديث القصة بنجاح!","success"),s(`/story/${t}`)}catch(w){const A=w instanceof Error?w.message:"فشل في تحديث القصة. الرجاء المحاولة مرة أخرى.";n(A,"error"),m(!1)}}};return k?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(P,{size:"16"})}):r?e.jsx(O,{children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-gray-800 p-8 rounded-lg shadow-xl",children:[e.jsx("h1",{className:"text-3xl font-bold text-amber-400 mb-6",children:"تعديل القصة"}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-lg font-medium text-gray-300 mb-2",children:"عنوان القصة"}),e.jsx("input",{type:"text",id:"title",value:l,onChange:y=>d(y.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-amber-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-lg font-medium text-gray-300 mb-2",children:"تصنيف القصة"}),e.jsx("select",{id:"category",value:h,onChange:y=>b(y.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-amber-500",required:!0,children:E.map(y=>e.jsx("option",{value:y,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-lg font-medium text-gray-300 mb-2",children:"محتوى القصة"}),e.jsx("textarea",{id:"content",value:x,onChange:y=>g(y.target.value),rows:15,className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-amber-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"image",className:"block text-lg font-medium text-gray-300 mb-2",children:"تغيير صورة القصة (اختياري)"}),e.jsx("input",{type:"file",id:"image",onChange:f,accept:"image/*",className:"w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-amber-50 file:text-amber-700 hover:file:bg-amber-100"}),j&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"معاينة الصورة الحالية:"}),e.jsx("img",{src:j,alt:"Preview",className:"max-w-xs max-h-48 rounded-lg shadow-md"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>s(`/story/${t}`),className:"flex items-center justify-center gap-2 bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-500 transition-colors",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:u,className:"flex items-center justify-center gap-2 bg-amber-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-amber-600 transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed",children:u?e.jsx(P,{size:"6"}):"حفظ التغييرات"})]})]})]})}):null},At=({toast:t,onRemove:s})=>{const a={success:e.jsx(He,{className:"text-green-500"}),error:e.jsx(Ve,{className:"text-red-500"}),info:e.jsx(Je,{className:"text-blue-500"})},n={success:"bg-green-800/90 border-green-600",error:"bg-red-800/90 border-red-600",info:"bg-blue-800/90 border-blue-600"};return e.jsxs("div",{className:`flex items-start gap-4 w-full max-w-sm p-4 text-white rounded-lg shadow-lg border-l-4 ${n[t.type]} backdrop-blur-sm animate-fade-in`,children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:a[t.type]}),e.jsx("p",{className:"flex-grow",children:t.message}),e.jsx("button",{onClick:()=>s(t.id),className:"flex-shrink-0 ml-4 p-1 rounded-full hover:bg-white/10",children:e.jsx(qe,{size:18})})]})},zt=()=>{const{toasts:t,removeToast:s}=$(),a=document.getElementById("toast-root");return a?Be.createPortal(e.jsx("div",{className:"fixed top-4 right-4 z-[100] space-y-3",children:t.map(n=>e.jsx(At,{toast:n,onRemove:s},n.id))}),a):null},Et=()=>{const t=Ke();return e.jsx(et,{mode:"wait",children:e.jsxs(Ye,{location:t,children:[e.jsx(R,{path:"/",element:e.jsx(bt,{})}),e.jsx(R,{path:"/story/:id",element:e.jsx(wt,{})}),e.jsx(R,{path:"/story/:id/edit",element:e.jsx(Pt,{})}),e.jsx(R,{path:"/create",element:e.jsx(vt,{})}),e.jsx(R,{path:"/generate",element:e.jsx(Ct,{})}),e.jsx(R,{path:"/profile",element:e.jsx(kt,{})})]},t.pathname)})},Tt=()=>{const{user:t,loading:s}=T();return s?e.jsx("div",{className:"flex justify-center items-center h-screen bg-gray-900",children:e.jsx(P,{size:"16"})}):t?e.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-900 text-gray-100",children:[e.jsx(ct,{}),e.jsx("main",{className:"flex-grow container mx-auto px-4 py-8",children:e.jsx(Et,{})}),e.jsx(dt,{})]}):e.jsx(It,{})};function Lt(){return e.jsx(it,{children:e.jsxs(lt,{children:[e.jsx(Tt,{}),e.jsx(zt,{})]})})}const ye=document.getElementById("root");if(!ye)throw new Error("Could not find root element to mount to");const $t=We.createRoot(ye);$t.render(e.jsx(Qe.StrictMode,{children:e.jsx(Xe,{children:e.jsx(Lt,{})})}));
